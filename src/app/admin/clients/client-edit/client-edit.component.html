<!-- Client Edit with Glassmorphism Design -->
<div class="min-h-screen relative">
  <!-- Background Effects -->
  <div class="fixed inset-0 -z-10 overflow-hidden">
    <div class="absolute -top-40 -right-40 w-96 h-96 bg-gradient-to-br from-amber-500/20 to-orange-500/20 rounded-full blur-3xl"></div>
    <div class="absolute -bottom-40 -left-40 w-96 h-96 bg-gradient-to-br from-indigo-500/20 to-purple-500/20 rounded-full blur-3xl"></div>
  </div>

  @if (isLoading()) {
    <div class="flex items-center justify-center min-h-[60vh]">
      <div class="text-center">
        <div class="relative w-16 h-16 mx-auto mb-4">
          <div class="w-16 h-16 border-4 border-indigo-200 dark:border-indigo-800 rounded-full"></div>
          <div class="w-16 h-16 border-4 border-indigo-600 dark:border-indigo-400 border-t-transparent rounded-full animate-spin absolute inset-0"></div>
        </div>
        <p class="text-slate-500 dark:text-slate-400">Loading client data...</p>
      </div>
    </div>
  } @else if (client()) {
    <div class="max-w-5xl mx-auto space-y-6 animate-fadeIn">
      <!-- Header -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="flex items-center gap-4">
          <a [routerLink]="['/admin/clients', client()!.id]" class="p-2 rounded-xl hover:bg-white/50 dark:hover:bg-slate-800/50 text-slate-500 hover:text-slate-900 dark:hover:text-white transition-all">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
          </a>
          <div>
            <h1 class="text-2xl font-bold text-slate-900 dark:text-white">Edit Client</h1>
            <p class="text-slate-500 dark:text-slate-400">{{ client()!.firstName }} {{ client()!.lastName }} â€¢ {{ client()!.clientCode }}</p>
          </div>
        </div>
        
        @if (hasChanges()) {
          <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 text-sm font-medium">
            <span class="w-2 h-2 rounded-full bg-amber-500 animate-pulse"></span>
            Unsaved changes
          </span>
        }
      </div>

      <!-- Main Content -->
      <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Sidebar Navigation -->
        <div class="lg:col-span-1">
          <div class="sticky top-6 space-y-2">
            @for (section of sections; track section.id) {
              <button 
                (click)="setActiveSection(section.id)"
                class="w-full flex items-center gap-3 px-4 py-3 rounded-xl font-medium transition-all duration-300 text-left"
                [ngClass]="{
                  'bg-white dark:bg-slate-800 text-slate-900 dark:text-white shadow-lg': activeSection() === section.id,
                  'text-slate-500 dark:text-slate-400 hover:bg-white/50 dark:hover:bg-slate-800/50': activeSection() !== section.id
                }">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="section.icon"></path>
                </svg>
                {{ section.label }}
              </button>
            }
          </div>
        </div>

        <!-- Form Content -->
        <div class="lg:col-span-3">
          <form [formGroup]="clientForm" (ngSubmit)="onSubmit()">
            <div class="relative overflow-hidden rounded-3xl backdrop-blur-xl bg-white/70 dark:bg-slate-800/70 border border-white/20 dark:border-slate-700/50 shadow-xl">
              
              <!-- Personal Information Section -->
              @if (activeSection() === 'personal') {
                <div class="p-8 animate-fadeIn">
                  <div class="flex items-center gap-4 mb-8">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center shadow-lg shadow-blue-500/30">
                      <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                      </svg>
                    </div>
                    <div>
                      <h2 class="text-xl font-bold text-slate-900 dark:text-white">Personal Information</h2>
                      <p class="text-slate-500 dark:text-slate-400">Update client's personal details</p>
                    </div>
                  </div>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- First Name -->
                    <div class="space-y-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">
                        First Name <span class="text-red-500">*</span>
                      </label>
                      <input 
                        type="text"
                        formControlName="firstName"
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 dark:focus:border-indigo-400 outline-none transition-all duration-300 text-slate-900 dark:text-white"
                        [ngClass]="{'border-red-500': formControls['firstName'].invalid && formControls['firstName'].touched}">
                      @if (getFieldError('firstName')) {
                        <p class="text-sm text-red-500">{{ getFieldError('firstName') }}</p>
                      }
                    </div>

                    <!-- Last Name -->
                    <div class="space-y-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">
                        Last Name <span class="text-red-500">*</span>
                      </label>
                      <input 
                        type="text"
                        formControlName="lastName"
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 dark:focus:border-indigo-400 outline-none transition-all duration-300 text-slate-900 dark:text-white"
                        [ngClass]="{'border-red-500': formControls['lastName'].invalid && formControls['lastName'].touched}">
                      @if (getFieldError('lastName')) {
                        <p class="text-sm text-red-500">{{ getFieldError('lastName') }}</p>
                      }
                    </div>

                    <!-- Email -->
                    <div class="space-y-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">
                        Email Address <span class="text-red-500">*</span>
                      </label>
                      <input 
                        type="email"
                        formControlName="email"
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 dark:focus:border-indigo-400 outline-none transition-all duration-300 text-slate-900 dark:text-white"
                        [ngClass]="{'border-red-500': formControls['email'].invalid && formControls['email'].touched}">
                      @if (getFieldError('email')) {
                        <p class="text-sm text-red-500">{{ getFieldError('email') }}</p>
                      }
                    </div>

                    <!-- Phone -->
                    <div class="space-y-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">
                        Phone Number <span class="text-red-500">*</span>
                      </label>
                      <input 
                        type="tel"
                        formControlName="phone"
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 dark:focus:border-indigo-400 outline-none transition-all duration-300 text-slate-900 dark:text-white">
                    </div>

                    <!-- Date of Birth -->
                    <div class="space-y-2 md:col-span-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">Date of Birth</label>
                      <input 
                        type="date"
                        formControlName="dateOfBirth"
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 dark:focus:border-indigo-400 outline-none transition-all duration-300 text-slate-900 dark:text-white">
                    </div>
                  </div>
                </div>
              }

              <!-- Account Details Section -->
              @if (activeSection() === 'account') {
                <div class="p-8 animate-fadeIn">
                  <div class="flex items-center gap-4 mb-8">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-emerald-500 to-green-500 flex items-center justify-center shadow-lg shadow-emerald-500/30">
                      <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                      </svg>
                    </div>
                    <div>
                      <h2 class="text-xl font-bold text-slate-900 dark:text-white">Account Details</h2>
                      <p class="text-slate-500 dark:text-slate-400">Manage account configuration</p>
                    </div>
                  </div>

                  <div class="space-y-6">
                    <!-- Status -->
                    <div class="space-y-3">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">Status</label>
                      <div class="flex items-center gap-3">
                        @for (status of statusOptions; track status) {
                          <label class="relative flex items-center justify-center px-6 py-3 rounded-xl cursor-pointer transition-all duration-300 border-2"
                            [ngClass]="{
                              'border-emerald-500 bg-emerald-50 dark:bg-emerald-900/30': formControls['status'].value === status && status === 'active',
                              'border-amber-500 bg-amber-50 dark:bg-amber-900/30': formControls['status'].value === status && status === 'pending',
                              'border-red-500 bg-red-50 dark:bg-red-900/30': formControls['status'].value === status && status === 'inactive',
                              'border-slate-200 dark:border-slate-700 hover:border-slate-300': formControls['status'].value !== status
                            }">
                            <input type="radio" formControlName="status" [value]="status" class="sr-only">
                            <span class="w-2 h-2 rounded-full mr-2"
                              [ngClass]="{
                                'bg-emerald-500': status === 'active',
                                'bg-amber-500': status === 'pending',
                                'bg-red-500': status === 'inactive'
                              }"></span>
                            <span class="font-medium capitalize"
                              [ngClass]="{
                                'text-emerald-700 dark:text-emerald-400': status === 'active',
                                'text-amber-700 dark:text-amber-400': status === 'pending',
                                'text-red-700 dark:text-red-400': status === 'inactive'
                              }">{{ status }}</span>
                          </label>
                        }
                      </div>
                    </div>

                    <!-- Account Type -->
                    <div class="space-y-3">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">Account Type</label>
                      <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        @for (type of accountTypes; track type) {
                          <label class="relative flex items-center justify-center p-4 rounded-xl cursor-pointer transition-all duration-300 border-2"
                            [ngClass]="{
                              'border-indigo-500 bg-indigo-50 dark:bg-indigo-900/30': formControls['accountType'].value === type,
                              'border-slate-200 dark:border-slate-700 hover:border-slate-300': formControls['accountType'].value !== type
                            }">
                            <input type="radio" formControlName="accountType" [value]="type" class="sr-only">
                            <span class="font-medium" [ngClass]="formControls['accountType'].value === type ? 'text-indigo-700 dark:text-indigo-400' : 'text-slate-700 dark:text-slate-300'">
                              {{ type }}
                            </span>
                          </label>
                        }
                      </div>
                    </div>

                    <!-- Risk Profile -->
                    <div class="space-y-3">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">Risk Profile</label>
                      <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        @for (risk of riskProfiles; track risk; let i = $index) {
                          <label class="relative flex flex-col items-center p-4 rounded-xl cursor-pointer transition-all duration-300 border-2"
                            [ngClass]="{
                              'border-indigo-500 bg-indigo-50 dark:bg-indigo-900/30': formControls['riskProfile'].value === risk,
                              'border-slate-200 dark:border-slate-700 hover:border-slate-300': formControls['riskProfile'].value !== risk
                            }">
                            <input type="radio" formControlName="riskProfile" [value]="risk" class="sr-only">
                            <div class="w-full h-2 rounded-full mb-2 overflow-hidden bg-slate-200 dark:bg-slate-700">
                              <div class="h-full rounded-full" [ngClass]="{
                                'w-1/4 bg-emerald-500': i === 0,
                                'w-2/4 bg-amber-500': i === 1,
                                'w-3/4 bg-orange-500': i === 2,
                                'w-full bg-red-500': i === 3
                              }"></div>
                            </div>
                            <span class="font-medium text-sm" [ngClass]="formControls['riskProfile'].value === risk ? 'text-indigo-700 dark:text-indigo-400' : 'text-slate-700 dark:text-slate-300'">
                              {{ risk }}
                            </span>
                          </label>
                        }
                      </div>
                    </div>

                    <!-- Investment Goal -->
                    <div class="space-y-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">Investment Goal</label>
                      <textarea 
                        formControlName="investmentGoal"
                        rows="3"
                        placeholder="Describe the client's investment goals..."
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 dark:focus:border-indigo-400 outline-none transition-all duration-300 text-slate-900 dark:text-white placeholder-slate-400 resize-none"></textarea>
                    </div>
                  </div>
                </div>
              }

              <!-- Address Section -->
              @if (activeSection() === 'address') {
                <div class="p-8 animate-fadeIn">
                  <div class="flex items-center gap-4 mb-8">
                    <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center shadow-lg shadow-purple-500/30">
                      <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      </svg>
                    </div>
                    <div>
                      <h2 class="text-xl font-bold text-slate-900 dark:text-white">Address Information</h2>
                      <p class="text-slate-500 dark:text-slate-400">Update client's address details</p>
                    </div>
                  </div>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2 md:col-span-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">Street Address</label>
                      <input type="text" formControlName="address" placeholder="123 Main Street"
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 outline-none transition-all text-slate-900 dark:text-white placeholder-slate-400">
                    </div>
                    <div class="space-y-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">City</label>
                      <input type="text" formControlName="city" placeholder="New York"
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 outline-none transition-all text-slate-900 dark:text-white placeholder-slate-400">
                    </div>
                    <div class="space-y-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">State / Province</label>
                      <input type="text" formControlName="state" placeholder="NY"
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 outline-none transition-all text-slate-900 dark:text-white placeholder-slate-400">
                    </div>
                    <div class="space-y-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">ZIP / Postal Code</label>
                      <input type="text" formControlName="zipCode" placeholder="10001"
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 outline-none transition-all text-slate-900 dark:text-white placeholder-slate-400">
                    </div>
                    <div class="space-y-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">Country</label>
                      <select formControlName="country"
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 outline-none transition-all text-slate-900 dark:text-white">
                        @for (country of countries; track country) {
                          <option [value]="country">{{ country }}</option>
                        }
                      </select>
                    </div>
                    <div class="space-y-2 md:col-span-2">
                      <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300">Notes</label>
                      <textarea formControlName="notes" rows="4" placeholder="Additional notes..."
                        class="w-full px-4 py-3 rounded-xl bg-slate-100/50 dark:bg-slate-900/50 border-2 border-transparent focus:border-indigo-500 outline-none transition-all text-slate-900 dark:text-white placeholder-slate-400 resize-none"></textarea>
                    </div>
                  </div>
                </div>
              }

              <!-- Form Actions -->
              <div class="px-8 py-6 bg-slate-50/50 dark:bg-slate-900/30 border-t border-slate-200/50 dark:border-slate-700/50 flex items-center justify-between">
                <a [routerLink]="['/admin/clients', client()!.id]" class="px-6 py-3 rounded-xl font-medium text-slate-700 dark:text-slate-300 hover:bg-white dark:hover:bg-slate-800 transition-all">
                  Cancel
                </a>
                <button type="submit" [disabled]="clientForm.invalid || isSubmitting() || !hasChanges()"
                  class="flex items-center gap-2 px-8 py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-medium shadow-lg shadow-indigo-500/30 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                  @if (isSubmitting()) {
                    <svg class="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Saving...
                  } @else {
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Save Changes
                  }
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  }
</div>

<style>
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
</style>